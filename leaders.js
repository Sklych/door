import{isDebug as e,getUserState as t,UserState as n}from"./network.js";function animateBackground(e){let t=document.getElementById(e),n=t.getContext("2d");function a(){t.width=window.innerWidth,t.height=window.innerHeight}a(),window.addEventListener("resize",a);let r=Array.from({length:120}).map(()=>({x:Math.random()*t.width,y:Math.random()*t.height,radius:2*Math.random()+1,speed:1.5*Math.random()+.5}));!function e(){n.clearRect(0,0,t.width,t.height),n.fillStyle="white",r.forEach(e=>{n.beginPath(),n.arc(e.x,e.y,e.radius,0,2*Math.PI),n.fill(),e.y+=e.speed,e.y>t.height&&(e.y=0,e.x=Math.random()*t.width)}),requestAnimationFrame(e)}()}function wins_text(e,t){return"ru"==e?` и выигрывает <span class="username-text">${t} USDT</span>`:` and wins <span class="username-text">${t} USDT</span>`}function you_win_text(e,t){return"ru"==e?` и выигрываешь <span class="username-text">${t} USDT</span>`:` and win <span class="username-text">${t} USDT</span>`}function buildButtonInnerHTML(e){let t=e.indexOf(" ");if(-1===t)return`<span class="username-text">${e}</span>`;let n=e.substring(0,t),a=e.substring(t+1);return`<span class="username-text">${n}</span>${a}`}function createReferralButton(e,t,n){if(!e)return null;let a=document.createElement("button");return a.classList.add("leaderboard-button"),e.user_name==t.user_name?a.innerHTML=`${buildButtonInnerHTML(t.text)}`:a.innerHTML=`${buildButtonInnerHTML(e.text)}`,e.reward&&e.reward>0&&(e.user_name==t.user_name?a.innerHTML+=you_win_text(n,e.reward):a.innerHTML+=wins_text(n,e.reward)),e.user_name==t.user_name?a.classList.add("blue"):a.classList.add("default"),a}function createScoreButton(e,t,n){if(!e)return null;let a=document.createElement("button");return a.classList.add("leaderboard-button"),e.user_name==t.user_name?a.innerHTML=`${buildButtonInnerHTML(t.text)}`:a.innerHTML=`${buildButtonInnerHTML(e.text)}`,e.reward&&e.reward>0&&(e.user_name==t.user_name?a.innerHTML+=you_win_text(n,e.reward):a.innerHTML+=wins_text(n,e.reward)),e.user_name==t.user_name?a.classList.add("blue"):a.classList.add("default"),a}function createNotInTopButton(e){let t=document.createElement("button");return t.innerHTML=`${buildButtonInnerHTML(e.text)}`,t.classList.add("leaderboard-button"),t.classList.add("blue"),t}function inviteFriendButton(e,t){let n=document.createElement("button");return n.textContent=e,n.classList.add("leaderboard-button"),n.classList.add("green"),n.addEventListener("click",()=>{window.open(t)}),n}function showContent(e){let t=document.getElementById("play_nav_item"),n=document.getElementById("tasks_nav_item"),a=document.getElementById("cash_out_nav_item");t.textContent=e.bottombar.playItem.title,n.textContent=e.bottombar.tasksItem.title,a.textContent=e.bottombar.withdrawItem.title,document.getElementById("progress").style.display="none",document.getElementById("error-content").style.display="none",document.getElementById("main-content").style.display="block",animateText(0,e.balance.value,"usdt-text","",e.balance.precision),animateText(0,e.reward.coefficient,"coefficient-text"," X"),animateBackground("content-background-stars");let r=document.getElementById("coefficient-menu-item"),s=document.getElementById("usdt-menu-item");r.addEventListener("click",()=>{document.getElementById("earn-nav-item").click()}),s.addEventListener("click",()=>{document.getElementById("withdraw-nav-item").click()});let l=document.querySelector(".leaders-container"),o=document.createElement("div");o.classList.add("board-title"),o.textContent=e.leaderBoardPage.referrals.title,l.appendChild(o),e.leaderBoardPage.referrals.top.forEach(t=>{l.appendChild(createReferralButton(t,e.leaderBoardPage.referrals.you,e.language))});let i=e.leaderBoardPage.referrals.top.some(t=>t.user_name===e.leaderBoardPage.referrals.you.user_name);i||l.appendChild(createNotInTopButton(e.leaderBoardPage.referrals.you)),l.appendChild(inviteFriendButton(e.leaderBoardPage.referrals.inviteFriendButtonText,`http://t.me/share/url?url=${e.referral.link}&text=${e.referral.inviteText}`));let d=document.createElement("div");d.classList.add("board-title"),d.textContent=e.leaderBoardPage.scores.title,l.appendChild(d),e.leaderBoardPage.scores.top.forEach(t=>{l.appendChild(createReferralButton(t,e.leaderBoardPage.scores.you,e.language))});let u=e.leaderBoardPage.scores.top.some(t=>t.user_name===e.leaderBoardPage.scores.you.user_name);u||l.appendChild(createNotInTopButton(e.leaderBoardPage.scores.you))}function animateText(e,t,n,a,r=1){let s=document.getElementById(n),l=performance.now();function o(n){let i=Math.min((n-l)/500,1);s.textContent=(e+(t-e)*i).toFixed(r)+a,i<1&&requestAnimationFrame(o)}requestAnimationFrame(o)}function showLoading(){document.getElementById("progress").style.display="block"}function showError(e){document.getElementById("progress").style.display="none",document.getElementById("main-content").style.display="none",document.getElementById("error-content").style.display="flex",document.getElementById("error-content").textContent=e,animateBackground("error-background-stars")}let tg=null;e||(tg=window.Telegram.WebApp).ready(),window.onload=function(){showLoading(),(async()=>{try{if(e){let n=await t("1","en",null,null,"leaderBoardPage");n?showContent(n):showError()}else{let a=tg.initDataUnsafe.user,r=a.language_code,s=tg.initDataUnsafe.start_param,l=`username=${tg.initDataUnsafe.user.username}, first_name=${tg.initDataUnsafe.user.first_name}, last_name=${tg.initDataUnsafe.user.last_name}`,o=await t(a.id,r??"en",s,l,"leaderBoardPage");o?showContent(o):showError()}}catch(i){e?console.error(`${i}`):console.error(`${i}, ${tg.initData}, ${tg.initDataUnsafe}, ${tg},`),showError(i)}})(),document.querySelectorAll(".nav-item").forEach(e=>{e.addEventListener("click",()=>{let t=e.getAttribute("data-url");t&&"leaders.html"!=t&&(window.location.href=t)})})};