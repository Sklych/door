import{isDebug as t,getUserState as e,postTaskComplete as a,UserState as n}from"./network.js";function animateBackground(t){let e=document.getElementById(t);console.log("bgCanvas ",e," by id ",t);let a=e.getContext("2d");function n(){e.width=window.innerWidth,e.height=window.innerHeight}n(),window.addEventListener("resize",n);let r=Array.from({length:120}).map(()=>({x:Math.random()*e.width,y:Math.random()*e.height,radius:2*Math.random()+1,speed:1.5*Math.random()+.5}));!function t(){a.clearRect(0,0,e.width,e.height),a.fillStyle="white",r.forEach(t=>{a.beginPath(),a.arc(t.x,t.y,t.radius,0,2*Math.PI),a.fill(),t.y+=t.speed,t.y>e.height&&(t.y=0,t.x=Math.random()*e.width)}),requestAnimationFrame(t)}()}async function sendTransaction(t,e,a){try{let n={validUntil:Math.floor(Date.now()/1e3)+120,messages:[{address:e,amount:1e9*a},]};console.log("before tx result ");let r=await t.sendTransaction(n);return console.log("tx result ",JSON.stringify(r)),!0}catch(o){return console.error(o),!1}}function showTransactionStatus(t){let e=`
      <div class="token" style="align: center;">
          <span>${t}</span>
      </div>`;showToast(e,5e3)}function showToast(t,e=3e3){let a=document.createElement("div");a.className="toast",a.innerHTML=t,document.getElementById("toast-container").appendChild(a),setTimeout(()=>a.classList.add("show"),10),setTimeout(()=>{a.classList.remove("show"),setTimeout(()=>a.remove(),300)},e)}function showContent(e,n){let r=document.getElementById("play_nav_item"),o=document.getElementById("tasks_nav_item"),i=document.getElementById("leaders_nav_item"),s=document.getElementById("cash_out_nav_item");r.textContent=e.bottombar.playItem.title,o.textContent=e.bottombar.tasksItem.title,i.textContent=e.bottombar.leadersItem.title,s.textContent=e.bottombar.withdrawItem.title,document.getElementById("progress").style.display="none",document.getElementById("error-content").style.display="none",document.getElementById("main-content").style.display="block",animateText(0,e.balance.value,"usdt-text","",e.balance.precision),animateText(0,e.reward.coefficient,"coefficient-text"," X"),animateBackground("content-background-stars");let l=document.getElementById("coefficient-menu-item");e.reward.coefficient==e.reward.maxCoefficient&&l.classList.add("gold");let d=document.getElementById("usdt-menu-item");l.addEventListener("click",()=>{}),d.addEventListener("click",()=>{document.getElementById("withdraw-nav-item").click()});let c=document.querySelector(".earn-container"),g=document.createElement("div");for(let m of(g.className="friends-invited",g.id="info-text",g.textContent=e.tasksPage.coefficientInfoText,c.appendChild(g),e.tasks)){console.log(m);let p=document.createElement("div");p.className="subscribe-bonus","popup"==m.id&&p.classList.add("gold"),p.id=m.id,p.textContent=m.title,p.addEventListener("click",()=>{"invite_friend"==m.id?window.open(`http://t.me/share/url?url=${e.referral.link}&text=${e.referral.inviteText}`):"start_main_bot"==m.id?(window.open(`https://t.me/${e.bot.id}?start=flappytappy`),(async()=>{try{t?await a("1",m.id):await a(e.uid,m.id),setTimeout(()=>{window.location.reload()},2e3)}catch(n){console.error(n),showError(e.language)}})()):"add_sklych_to_group"==m.id?(window.open("https://t.me/sklych_bot?startgroup=new"),(async()=>{try{t?await a("1",m.id):await a(e.uid,m.id),setTimeout(()=>{window.location.reload()},2e3)}catch(n){console.error(n),showError(e.language)}})()):"shorts"==m.id?window.open(`https://t.me/flappytappywallet?text=${e.tasksPage.shareShortText}`):"subscribe_to_news"==m.id?(window.open("https://t.me/flappytappynews"),(async()=>{try{t?await a("1",m.id):await a(e.uid,m.id),setTimeout(()=>{window.location.reload()},2e3)}catch(n){console.error(n),showError(e.language)}})()):"popup"==m.id&&(n.wallet?(async()=>{if(await sendTransaction(n,e.tasksPage.popupBalanceAddress,e.tasksPage.popupBalanceTonAmount)){showTransactionStatus(e.tasksPage.popupBalanceTransactionCompleted),console.log("sendTransaction = true");try{t?await a("1",m.id):await a(e.uid,m.id),setTimeout(()=>{window.location.reload()},2e3)}catch(r){console.error(r),showError(e.language)}}else console.log("sendTransaction = false"),console.log(e.tasksPage.popupBalanceTransactionFailed),showTransactionStatus(e.tasksPage.popupBalanceTransactionFailed)})():n.openModal())}),c.appendChild(p)}let u=document.createElement("div");u.className="friends-invited",u.id="friends-invited",u.textContent=`${e.tasksPage.friendsInvitedPrefix}: ${e.referral.friendsInvited}`,c.appendChild(u)}function animateText(t,e,a,n,r=1){let o=document.getElementById(a),i=performance.now();function s(a){let l=Math.min((a-i)/500,1);o.textContent=(t+(e-t)*l).toFixed(r)+n,l<1&&requestAnimationFrame(s)}requestAnimationFrame(s)}function showLoading(){document.getElementById("progress").style.display="block"}function showError(t){document.getElementById("progress").style.display="none",document.getElementById("main-content").style.display="none",document.getElementById("error-content").style.display="flex","ru"==t?(document.getElementById("error-message").textContent="Произошла ошибка",document.getElementById("reload-button").textContent="Перезагрузить"):(document.getElementById("error-message").textContent="An error occurred",document.getElementById("reload-button").textContent="Reload"),animateBackground("error-background-stars")}let tg=null;t||(tg=window.Telegram.WebApp).ready(),window.onload=function(){showLoading(),(async()=>{try{if(t){let a=new TON_CONNECT_UI.TonConnectUI({manifestUrl:"https://pastebin.com/raw/B26zvtVz",language:"en"}),n=await e("1","en",null,null,"tasksPage");n?showContent(n,a):showError("en")}else{let r=tg.initDataUnsafe.user,o=r.language_code,i=tg.initDataUnsafe.start_param,s=`username=${tg.initDataUnsafe.user.username}, first_name=${tg.initDataUnsafe.user.first_name}, last_name=${tg.initDataUnsafe.user.last_name}`,l=new TON_CONNECT_UI.TonConnectUI({manifestUrl:"https://pastebin.com/raw/B26zvtVz",language:o}),d=await e(r.id,o??"en",i,s,"tasksPage");d?showContent(d,l):showError(o)}}catch(c){console.log(c),t?console.error(`${c}`):console.error(`${c}, ${tg.initData}, ${tg.initDataUnsafe}, ${tg},`),showError("en")}})(),document.querySelectorAll(".nav-item").forEach(t=>{t.addEventListener("click",()=>{let e=t.getAttribute("data-url");e&&"earn.html"!=e&&(window.location.href=e)})})};