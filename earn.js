import{isDebug as t,getUserState as e,postTaskComplete as n,UserState as a}from"./network.js";function animateBackground(t){let e=document.getElementById(t),n=e.getContext("2d");function a(){e.width=window.innerWidth,e.height=window.innerHeight}a(),window.addEventListener("resize",a);let i=Array.from({length:120}).map(()=>({x:Math.random()*e.width,y:Math.random()*e.height,radius:2*Math.random()+1,speed:1.5*Math.random()+.5}));!function t(){n.clearRect(0,0,e.width,e.height),n.fillStyle="white",i.forEach(t=>{n.beginPath(),n.arc(t.x,t.y,t.radius,0,2*Math.PI),n.fill(),t.y+=t.speed,t.y>e.height&&(t.y=0,t.x=Math.random()*e.width)}),requestAnimationFrame(t)}()}function showContent(e){let a=document.getElementById("play_nav_item"),i=document.getElementById("tasks_nav_item"),r=document.getElementById("cash_out_nav_item");a.textContent=e.bottombar.playItem.title,i.textContent=e.bottombar.tasksItem.title,r.textContent=e.bottombar.withdrawItem.title,document.getElementById("progress").style.display="none",document.getElementById("error-content").style.display="none",document.getElementById("main-content").style.display="block",animateText(0,e.balance.value,"usdt-text","",e.balance.precision),animateText(0,e.reward.coefficient,"coefficient-text"," X"),animateBackground("content-background-stars");let o=document.getElementById("coefficient-menu-item"),l=document.getElementById("usdt-menu-item");o.addEventListener("click",()=>{}),l.addEventListener("click",()=>{document.getElementById("withdraw-nav-item").click()});let s=document.querySelector(".earn-container"),d=document.createElement("div");for(let c of(d.className="friends-invited",d.id="info-text",d.textContent=e.tasksPage.coefficientInfoText,s.appendChild(d),e.tasks)){console.log(c);let m=document.createElement("div");m.className="subscribe-bonus",m.id=c.id,m.textContent=c.title,m.addEventListener("click",()=>{"invite_friend"==c.id?window.open(`http://t.me/share/url?url=${e.referral.link}&text=${e.referral.inviteText}`):"start_main_bot"==c.id?(window.open(`https://t.me/${e.bot.id}?start=flappytappy`),(async()=>{try{t?await n("1",c.id):await n(e.uid,c.id),setTimeout(()=>{window.location.reload()},2e3)}catch(a){console.error(a),showError(a)}})()):"add_sklych_to_group"==c.id?(window.open("https://t.me/sklych_bot?startgroup=new"),(async()=>{try{t?await n("1",c.id):await n(e.uid,c.id),setTimeout(()=>{window.location.reload()},2e3)}catch(a){console.error(a),showError(a)}})()):"shorts"==c.id&&window.open(`https://t.me/flappytappywallet?text=${e.tasksPage.shareShortText}`)}),s.appendChild(m)}let g=document.createElement("div");g.className="friends-invited",g.id="friends-invited",g.textContent=`${e.tasksPage.friendsInvitedPrefix}: ${e.referral.friendsInvited}`,s.appendChild(g)}function animateText(t,e,n,a,i=1){let r=document.getElementById(n),o=performance.now();function l(n){let s=Math.min((n-o)/500,1);r.textContent=(t+(e-t)*s).toFixed(i)+a,s<1&&requestAnimationFrame(l)}requestAnimationFrame(l)}function showLoading(){document.getElementById("progress").style.display="block"}function showError(t){document.getElementById("progress").style.display="none",document.getElementById("main-content").style.display="none",document.getElementById("error-content").style.display="flex",document.getElementById("error-content").textContent=t,animateBackground("error-background-stars")}let tg=null;t||(tg=window.Telegram.WebApp).ready(),window.onload=function(){showLoading(),(async()=>{try{if(t){let n=await e("1","en",null,null);n?showContent(n):showError()}else{let a=tg.initDataUnsafe.user,i=a.language_code,r=tg.initDataUnsafe.start_param,o=`username=${tg.initDataUnsafe.user.username}, first_name=${tg.initDataUnsafe.user.first_name}, last_name=${tg.initDataUnsafe.user.last_name}`,l=await e(a.id,i??"en",r,o);l?showContent(l):showError()}}catch(s){t?console.error(`${s}`):console.error(`${s}, ${tg.initData}, ${tg.initDataUnsafe}, ${tg},`),showError(s)}})(),document.querySelectorAll(".nav-item").forEach(t=>{t.addEventListener("click",()=>{let e=t.getAttribute("data-url");e&&"earn.html"!=e&&(window.location.href=e)})})};